<% flash.each do |key, value| %>
 <div id='flash' class="flash flash_<%= key %>">
   <%= value %>
 </div>
<% end %>
<article id="blog_post">
  <header>
    <h1><%= @post.title %></h1>
    <section class='details'>
      <time datetime="<%=l @post.published_at.to_date, :format => :default %>" class='posted_at'>
        <%= t('created_at', :scope => 'refinery.blog.shared.posts', :when => l(@post.published_at.to_date, :format => :short)) %>
      </time>
      <%= content_tag(:div, "#{t('by', :scope => 'refinery.blog.posts.show')} #{@post.author.username}", :class => "blog_author") if @post.author.present? %>
      <% if @post.source_url.present? %>
        <div class='blog_source'>
          <%= "#{t('source', :scope => 'refinery.blog.posts.show')}: " %>
          <%= link_to (@post.source_url_title.blank? ? @post.source_url : @post.source_url_title), @post.source_url %>
        </div>
      <% end %>
      <% if (categories = @post.categories).any? %>
        <aside class='filed_in'>
          <%= t('filed_in', :scope => 'refinery.blog.posts.show') %>
          <% categories.each_with_index do |category, index| %>
            <%= link_to category.title, refinery.blog_category_path(category) -%><%= ',' if index < ((categories.length) - 1) %>
          <% end %>
        </aside>
      <% end %>
    </section>
  </header>
  <%= @post.body.html_safe %>

  <% if Refinery::Blog::Post::ShareThis.enabled? %>
    <span class="st_sharethis" displayText="ShareThis"></span>
  <% end %>
</article>

<% content_for :right do %>
  <% if @post.locations.present? %>
    <div class="blog_locations">
      <h2>Locations</h2>
      <ul>
      <% @post.locations.each do |location| %>
        <li><%= link_to location.name, refinery.locations_location_path(location) %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <% if @post.accommodations.present? %>
    <div class="blog_locations">
      <h2>Accommodations</h2>
      <ul>
        <% @post.accommodations.each do |accommodation| %>
          <li><%= link_to accommodation.name, refinery.accommodations_accommodation_path(accommodation) %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <% if @post.activities.present? %>
    <div class="blog_locations">
      <h2>Activities</h2>
      <ul>
        <% @post.activities.each do |activity| %>
          <li><%= link_to activity.name, refinery.activities_activity_path(activity) %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>


<%= render :partial => '/refinery/draft_page_message' unless @post.nil? or @post.live? -%>

